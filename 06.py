big_map = '''....................................#.............#...............#..............................................................#
........................#....#............................................##.......#...................................#..........
.........#...............................................#..#.......#...#...........#......................#......................
...........#...........#...................#...........#.........................................#............................#...
................................................................#.....#...............................................#........#..
......................#..........#.#.......................................#...#........................................#.........
....#.......................#............#............#....#....................................................................#.
#.........#....................#.............#......................#............#....#..#................#........#.#.....#......
.................##...................#.................................#.........................................................
...........#...................................................................##..........#..........#.....#...............#.....
..................................#.........#....................................#....#..#...........................#............
............#.....#............................................................#......................#........#........#.........
.........#.........#......#...#.........#..............................................................................#..........
.........#..............................#..............#...........#.......................................#....#.............#...
...................................................................................................#..........#...................
....#.........#......................#..........#.........................................................................#......#
..............#.#........#..#......#..............................................................................................
#....#....#........................#...#...........................................#.....................#..#.......#...#.........
...............................#.........#........#.....................................#.........................................
................................#.....#..........#..........................................................#.....................
...#.......#...........#.....................................................#.....#...#.#..#...............#.#...................
...#...............#..#..................#.........................#................................................#.............
.#................#................................................#.#...........................#.............#................#.
....................#...............#..............#.........................................................#................#...
...............................................................................................#..........#.......................
............#......................................#....................................................#.........................
.......#.....#..................#....................................................................#..................#.....#...
...........#..........................................#.#.........................................................................
..........#..............................#.................................................................#..............#.......
...............#.........#...........#..........................................................................#.................
...............##................................................................##...#....................#....................#.
............##..........................................................................#....#............#.......................
........#.............#.#..#......#..#...........................#........#...........................#....................#......
...............................................................#........................#.#...................................#...
..#.....#.#............................#..........................................................................................
............................................#.#...........#....#............#.....#.......#..............#...................#....
..........................#............................#.#........................#......................#....#...................
..................#.......................#....#....................................#....................................#........
................#............................................#..............#...............................................#.#...
.............#.......................#...#............#...........................................................#..............#
#.#...#.............................................................#.#...........................................................
....#.............#..#.............................................#.............................#................................
..........................................#........#....#.........................#......................................#........
............................#..........#...........................#.......................................#......................
...#.......#..............#...........................#................................................#.......................#..
.#...............................#......................#...................#.........#...........................................
.#.....#......#........................#........#...............#..............................................#..........#.......
...........................................................................................................................#......
........................#......................................#............#.....................................................
........#.....#........#...............#.............#....#..........................................#.#.........................#
...........#........#.......#.........................................#.............................................#.............
.........#......#..........................................................................................#.....#................
........................................#...#...............#..................................#...........#......................
.......................................#.......#.#....#...#.................#.....#......^#.......................................
.#............#......#..........................................#.#......................................#............#.......#...
.................#.......#.........#........#..........................................................................#.....#....
...#..............................#.................#.........................#.........#.........................................
...#.................................................#..............#......................................................#......
....................#.#...............................#................#.....##...................................................
.........#...#....#.............................#.........#....#.....##............................#........#.....................
........#....#..............................#..................................................................#....#......#......
..........................#..#...........#..............#...............#....#..........#.........................................
...........#..........#...........................................#.......................##......................................
.............................................................................................#...................#...........#....
...............................#................#.....#...#..#....#...............................................................
#...#........#...#...................#.......#......................................................................#.............
#..................#..................................................................................#....................#..#..#
.#............#..#...........#................#.......#........#.........#...........#..............#.............................
.......................................#....#........#..............................................#..........#..................
...#....#........................................#....#...........................................................#....#.......#..
..............#....#.......................................#.............#..#.................................#...................
........................................#.#.......................#.#.......................................#.....................
......................#...#....................................................................................#.................#
........#...#...........#.....................#......#..........................................#.....................#.....#.....
...#......................#..........#............................................................................................
..............................................................................#..........#.....#..........#...#...................
........#............#.............#........##..................................................#...#.............................
..#....................................................................#.................#..........#.......#.........##..........
...................#.....................................................#......................#...#..#............#.............
......................................##.........#........................................................#...........#...........
..#..................................................#........................#...................#...............#...............
....#...................................#........#........................................................#.....................#.
....#.#......#..........................................#........................#................................................
#........................#.....................................................................................#...#..............
.#.............................#.......#...............#............#............#.....#.....#........#......#....................
....#......................................................#.......................................................#.......#...#..
............#.........................#.......##..............................#...................#.....#......#..................
........................................................................................#........................#.........#......
.#.......................#.........................#................#..##.........#..#.....................................#......
#...............#................#...#........#.........#......................#...................................#......#.#.....
................#............................##...................................#............#.....................#............
..#...#.................................................................#.........#.........................##................#...
...........................................#.................#............................#..#..............#......#.#............
.................#...........#..................#................#........#...............................#.................#..#.#
.......#.......................#................................#.#...............................................................
.......#.........#.........#...........................................................................#.........#...........#....
.....#.#................................................#.......#..........#......................................................
......................#.........................................#................#...............................#................
..........................#....#.......#....#.................#.#.................................................##...#..#.......
......................................................#.......#..#.....#............#...#..................................#......
.........#.#...............................#..........#...............................#...............#......................#....
..#...........................#.............................#............#...............#......#........................#........
.........#................................................................#....#..#.....##................#.........#.......#.....
...#....................................#...........#.............#...........................................#...................
#.........................#..........#.....................#......#.............#...........#...................................##
....................#......#...#.#.............................................#.............................#..............#.....
.....................#...#.....#......#.............................#........#......#.............#...............................
..................#.............................................................................#..............#..................
.......#...........................#........................................................................#...............#.....
............................................#......................................#..............................................
.....#..........#..................#.............#................................................#..................#...#......##
..............................................................#........................................#...............#..........
...................................#.#........................................................#.#...........#.....................
...#....................#........#.....................#..................................#..............#..#.....................
.................#....................#...#.....#..........#......#...........................#.#............................#.#..
....................................................#.............#..#.....#......................................................
.......#..............................#...............................................#.........................#.......#.........
........#...............#.................................................................................................#......#
#.#.#..............................................................#..............#................#...........#..........#.......
..#.....................................#...........#................................................#................#......#....
#.........................................................#...#................................#......#.#..........#..............
.#...#................#......#................##...#.........#.............#........#.........#........#.....#....................
................#..........................#.#................................................#.............#.....................
..............#................................................................#.............................#.............#......
..................................#...................................#...........................................................
........#.................#....#.........................................................................................#........
...........#...................#........#.......#................................................#..#......#..#...................
.........#.....#......................................................................#.........................#.....#...........
..........................................................#.............................................#.....#...................
...............#.##.................#....#.................#...#.......................#...................#........#.............'''


class Map:
    def __init__(self, map, pos):
        self.map: list[list] = map
        self.pos: list[int, int] = pos
        self.orientation: int = 0


    def rotate_anti(self: list[list]):
        self.map = [list(list_1d) for list_1d in zip(*[sub[::-1] for sub in self.map])]
        temp = self.pos[1]
        self.pos[1] = self.pos[0]
        self.pos[0] = len(self.map[0]) - 1 - temp
        self.orientation -= 90


    def navigation_successful(self, map, pos: list[int, int], return_map=False) -> bool | list:
        rotates = 0

        while True:
            above = self.map[pos[0]-1][pos[1]]
            if above is False:
                self.map[pos[0] - 1][pos[1]] = True
                self.pos[0] -= 1
            elif above is True:
                self.map[pos[0] - 1][pos[1]] = "DANGERZONE"
                self.pos[0] -= 1
            elif above == "DANGERZONE":
                return False
            elif above == "#":
                self.rotate_anti()
                rotates += 1
            if pos[0] == 0:
                if return_map is False:
                    return True
                for i in range(rotates//90):
                    self.rotate_anti()
                return map


class GuardMap:
    def __init__(self, map_str: str) -> None:
        map_bool: list[list | tuple[bool | str]] = []

        for i, line in enumerate(map_str.split('\n')):
            map_bool.append([])
            for j, char in enumerate(line):
                if char == ".":
                    map_bool[-1].append(False)
                elif char == "^":
                    POS = (i, j)
                    map_bool[-1].append(True)
                else:
                    map_bool[-1].append(char)
            map_bool[-1] = tuple(map_bool[-1])
        self.map = map_bool
        self.initial_pos = POS











def begin_phase2_electric_bogaloo(map, INITIAL_POS) -> int:
    nons = 0
    mega_map_bool: list[list[list[bool|str]]] = []
    for i, line in enumerate(map):
        for j, char in enumerate(line):
            if char != "#" and char != "^":
                nons += 1
                print(nons, flush=True)
                temp_map = [list(row) for row in map]
                temp_map[i][j] = "#"
                mega_map_bool.append(temp_map)

    print(f"Height: {len(map)}")
    print(f"Width: {len(map[0])}")
    runnin = 0
    for bleh, sub_map_bool in enumerate(mega_map_bool):
        if navigation_successful(sub_map_bool, list(INITIAL_POS)) is False:
            runnin += 1
        print(f"{runnin} found out of {bleh}", flush=True)
    return runnin


def main():
    guard_map = GuardMap(big_map)
    nof_loops = begin_phase2_electric_bogaloo(guard_map.map, guard_map.initial_pos)
    print(f"Statisfactory placements: {nof_loops}")


if __name__ == "__main__":
    main()